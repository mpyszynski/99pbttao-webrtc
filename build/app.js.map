{"version":3,"sources":["../src/app.js"],"names":["express","require","http","app","server","createServer","socket","io","cookieParser","path","rooms","use","json","static","join","__dirname","on","roomID","push","id","otherUser","find","emit","to","payload","target","incoming","candidate","get","req","res","sendFile","module","exports"],"mappings":";;AAAA,IAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA,IAAMC,OAAOD,QAAQ,MAAR,CAAb;AACA,IAAME,MAAMH,SAAZ;AACA,IAAMI,SAASF,KAAKG,YAAL,CAAkBF,GAAlB,CAAf;AACA,IAAMG,SAASL,QAAQ,WAAR,CAAf;AACA,IAAMM,KAAKD,OAAOF,MAAP,CAAX;AACA,IAAMI,eAAeP,QAAQ,eAAR,CAArB;AACA,IAAMQ,OAAOR,QAAQ,MAAR,CAAb;;AAEA,IAAMS,QAAQ,EAAd;;AAEAP,IAAIQ,GAAJ,CAAQH,cAAR;AACAL,IAAIQ,GAAJ,CAAQX,QAAQY,IAAR,EAAR;AACAT,IAAIQ,GAAJ,CAAQX,QAAQa,MAAR,CAAeJ,KAAKK,IAAL,CAAUC,SAAV,EAAqB,iBAArB,CAAf,CAAR;;AAEA;AACAR,GAAGS,EAAH,CAAM,YAAN,EAAoB,kBAAU;AAC5B;AACAV,SAAOU,EAAP,CAAU,WAAV,EAAuB,kBAAU;AAC/B;AACA,QAAIN,MAAMO,MAAN,CAAJ,EAAmB;AACjBP,YAAMO,MAAN,EAAcC,IAAd,CAAmBZ,OAAOa,EAA1B;AACD,KAFD,MAEO;AACL;AACAT,YAAMO,MAAN,IAAgB,CAACX,OAAOa,EAAR,CAAhB;AACD;;AAED;AACA,QAAMC,YAAYV,MAAMO,MAAN,EAAcI,IAAd,CAAmB;AAAA,aAAMF,OAAOb,OAAOa,EAApB;AAAA,KAAnB,CAAlB;AACA;AACA,QAAKC,SAAL,EAAgB;AACdd,aAAOgB,IAAP,CAAY,YAAZ,EAA0BF,SAA1B;AACAd,aAAOiB,EAAP,CAAUH,SAAV,EAAqBE,IAArB,CAA0B,aAA1B,EAAyChB,OAAOa,EAAhD;AACD;AACF,GAhBD;;AAkBA;AACAb,SAAOU,EAAP,CAAU,OAAV,EAAmB,mBAAW;AAC5B;AACA;AACAT,OAAGgB,EAAH,CAAMC,QAAQC,MAAd,EAAsBH,IAAtB,CAA2B,OAA3B,EAAoCE,OAApC;AACD,GAJD;AAKA;AACAlB,SAAOU,EAAP,CAAU,QAAV,EAAoB,mBAAW;AAC7B;AACAT,OAAGgB,EAAH,CAAMC,QAAQC,MAAd,EAAsBH,IAAtB,CAA2B,QAA3B,EAAqCE,OAArC;AACD,GAHD;AAIA;AACA;AACAlB,SAAOU,EAAP,CAAU,eAAV,EAA2B,oBAAY;AACrCT,OAAGgB,EAAH,CAAMG,SAASD,MAAf,EAAuBH,IAAvB,CAA4B,eAA5B,EAA6CI,SAASC,SAAtD;AACH,GAFC;AAGD,CApCD;;AAuCAxB,IAAIyB,GAAJ,CAAQ,GAAR,EAAa,UAACC,GAAD,EAAKC,GAAL,EAAY;AACvBA,MAAIC,QAAJ,CAAatB,KAAKK,IAAL,CAAUC,SAAV,EAAqB,4BAArB,CAAb;AACD,CAFD;;AAKAiB,OAAOC,OAAP,GAAiB,EAAE9B,QAAF,EAAOC,cAAP,EAAjB","file":"app.js","sourcesContent":["const express = require('express');\nconst http = require('http');\nconst app = express();\nconst server = http.createServer(app);\nconst socket = require('socket.io');\nconst io = socket(server);\nconst cookieParser = require('cookie-parser');\nconst path = require('path');\n\nconst rooms = {};\n\napp.use(cookieParser());\napp.use(express.json());\napp.use(express.static(path.join(__dirname, '../client/build')));\n\n// On server connection, new socket object\nio.on(\"connection\", socket => {\n  // Attach event listener \"join room\", pull roomID off url\n  socket.on(\"join room\", roomID => {\n    // Server checks if room is in the room collection, and pushes the id into the same array\n    if (rooms[roomID]) {\n      rooms[roomID].push(socket.id);\n    } else {\n      // If it doesnt exist, the id is put into a new room array in the rooms object\n      rooms[roomID] = [socket.id];\n    }\n\n    // Is there somebody in the room? See if there is an id in that array that is not ours\n    const otherUser = rooms[roomID].find(id => id !== socket.id);\n    // Let ourselves know that there is a user in the room, and the other user that we are joining\n    if  (otherUser) {\n      socket.emit(\"other user\", otherUser);\n      socket.to(otherUser).emit(\"user joined\", socket.id)\n    }\n  });\n\n  // When the offer event is fired, it accepts the payload as an argument\n  socket.on(\"offer\", payload => {\n    // Send an event to payload.target (the person you are calling)\n    // Emit the offer event, and the information with who you are, and the offer you are sending to the other user\n    io.to(payload.target).emit(\"offer\", payload)\n  });\n  // Listen on answer, get the payload object\n  socket.on(\"answer\", payload => {\n    // Emits an answer with the payload to the calling peer\n    io.to(payload.target).emit(\"answer\", payload )\n  });\n  // Ice-candidate is a way for 2 peers to agree upon a connection\n  // Used by both peers when peer 1 or 2 come up with a candidate, until they find one that works\n  socket.on(\"ice-candidate\", incoming => {\n    io.to(incoming.target).emit(\"ice-candidate\", incoming.candidate);\n});\n});\n\n\napp.get('*', (req,res) =>{\n  res.sendFile(path.join(__dirname, '../client/build/index.html'));\n});\n\n\nmodule.exports = { app, server };\n"]}